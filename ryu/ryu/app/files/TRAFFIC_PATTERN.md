# ğŸ“Š TRAFFIC PATTERN & LOGGING DOCUMENTATION

## ğŸ¯ Traffic Pattern

### **Cycle: 1 Hour (3600 seconds)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1 HOUR CYCLE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   0-30 min (NAIK)       â”‚   30-60 min (TURUN)             â”‚
â”‚   13000 â†’ 19800         â”‚   19800 â†’ 13000                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Menit:  0    10    20    30    40    50    60
Bytes:  13k  15k   17k   19k   17k   15k   13k
        â””â”€â”€â”€â”€ NAIK â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€ TURUN â”€â”€â”€â”€â”˜
```

### **Formula:**
- Base: 16400 bytes (middle point)
- Amplitude: Â±3400 bytes
- Pattern: Sine wave (smooth transition)
- Noise: Â±5% random variation
- Range: 13000 - 19800 bytes per flow

---

## ğŸ“‹ Log Format

### **Log Output Example:**

```
================================================================================
Second: 125s | Cycle: 2min | Phase: NAIK
Total REAL traffic from D-ITG: 48750 bytes
Target per flow: 14200 bytes (13000-19800 range)
Active flows: 3
--------------------------------------------------------------------------------
  Flow 1/3: 10.0.1.1â†’10.0.1.2
    D-ITG Real: 18,250B (101 pkts)
    Scaled:     14,680B (81 pkts)
    Proportion: 37.44% of total traffic
    Saved to DB: bytes_tx=14680, bytes_rx=14534
  Flow 2/3: 10.0.2.1â†’10.0.2.2
    D-ITG Real: 22,000B (122 pkts)
    Scaled:     15,120B (84 pkts)
    Proportion: 45.13% of total traffic
    Saved to DB: bytes_tx=15120, bytes_rx=15267
  Flow 3/3: 10.0.3.1â†’10.0.3.2
    D-ITG Real: 8,500B (47 pkts)
    Scaled:     13,400B (74 pkts)
    Proportion: 17.44% of total traffic
    Saved to DB: bytes_tx=13400, bytes_rx=13468
--------------------------------------------------------------------------------
SUMMARY: Total scaled traffic saved: ~43,200 bytes
================================================================================
```

---

## ğŸ” Log Interpretation

### **Header Information:**
- **Second**: Elapsed time since simulation start
- **Cycle**: Current minute in the 1-hour cycle (0-59)
- **Phase**: NAIK (0-30min) or TURUN (30-60min)

### **Summary:**
- **Total REAL traffic from D-ITG**: Actual bytes generated by D-ITG
- **Target per flow**: Base target for scaling (with pattern)
- **Active flows**: Number of flows with traffic in this second

### **Per Flow Details:**
- **D-ITG Real**: Actual traffic captured from switches
- **Scaled**: Traffic after scaling to target range (saved to DB)
- **Proportion**: This flow's share of total D-ITG traffic
- **Saved to DB**: Exact values inserted into PostgreSQL

---

## ğŸ“Š Verification Queries

### **Check Pattern in Database:**

```sql
-- View traffic pattern over time
SELECT 
    EXTRACT(EPOCH FROM timestamp) as seconds,
    src_ip,
    dst_ip,
    bytes_tx,
    bytes_rx
FROM traffic.flow_stats_
ORDER BY timestamp
LIMIT 100;

-- Check bytes_tx range
SELECT 
    MIN(bytes_tx) as min_bytes,
    MAX(bytes_tx) as max_bytes,
    AVG(bytes_tx) as avg_bytes,
    COUNT(*) as total_records
FROM traffic.flow_stats_;

-- Expected:
-- min_bytes: ~13000
-- max_bytes: ~19800
-- avg_bytes: ~16400
```

### **View Pattern by Minute:**

```sql
SELECT 
    EXTRACT(EPOCH FROM timestamp)::INTEGER / 60 as minute,
    AVG(bytes_tx) as avg_bytes,
    COUNT(*) as flow_count
FROM traffic.flow_stats_
GROUP BY minute
ORDER BY minute;
```

---

## ğŸ¯ Key Points

1. âœ… **D-ITG generates REAL traffic** (any amount)
2. âœ… **Controller captures REAL bytes** from switches
3. âœ… **Scales to 13000-19800** per flow while keeping proportions
4. âœ… **Pattern: 30min UP, 30min DOWN** (smooth sine wave)
5. âœ… **Detailed logs** show D-ITG real vs scaled values
6. âœ… **All scaled values saved** to PostgreSQL

---

## ğŸ“ Log File Location

```bash
# View real-time logs
tail -f /tmp/ryu_controller.log

# Search specific patterns
grep "D-ITG Real" /tmp/ryu_controller.log
grep "Scaled" /tmp/ryu_controller.log
grep "Phase: NAIK" /tmp/ryu_controller.log
```

---

## ğŸ”§ Tuning (if needed)

To adjust D-ITG traffic generation:

```python
# In spine_leaf_voip_simulation.py, line ~150:
# Current: -c 160 (packet size), -C 50 (packets/sec)

# For more traffic:
cmd = f'ITGSend -T 1 -a {dst_ip} -c 200 -C 100 ...'  # Double traffic

# For less traffic:
cmd = f'ITGSend -T 1 -a {dst_ip} -c 120 -C 25 ...'   # Half traffic
```

---

## âœ… Expected Behavior

**Minute 0-10 (NAIK):**
```
D-ITG: 50,000B â†’ Scaled: ~14,000B per flow
D-ITG: 52,000B â†’ Scaled: ~15,000B per flow
D-ITG: 55,000B â†’ Scaled: ~16,000B per flow
```

**Minute 20-30 (NAIK puncak):**
```
D-ITG: 60,000B â†’ Scaled: ~18,000B per flow
D-ITG: 62,000B â†’ Scaled: ~19,000B per flow
D-ITG: 61,000B â†’ Scaled: ~18,500B per flow
```

**Minute 30-40 (TURUN):**
```
D-ITG: 58,000B â†’ Scaled: ~17,500B per flow
D-ITG: 55,000B â†’ Scaled: ~16,000B per flow
D-ITG: 52,000B â†’ Scaled: ~15,000B per flow
```

**Minute 50-60 (TURUN balik ke awal):**
```
D-ITG: 48,000B â†’ Scaled: ~14,000B per flow
D-ITG: 46,000B â†’ Scaled: ~13,500B per flow
D-ITG: 45,000B â†’ Scaled: ~13,200B per flow
```

Pattern repeats every 60 minutes! ğŸ”„
